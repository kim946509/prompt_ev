<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt 목록 - Prompt Evaluation System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Claude 색상 팔레트 */
        :root {
            --claude-bg: #1a1a1a;
            --claude-surface: #2d2d2d;
            --claude-border: #404040;
            --claude-text: #e5e5e5;
            --claude-text-muted: #a0a0a0;
            --claude-accent: #cc785c;
            --claude-accent-hover: #b86b4f;
        }

        body {
            background-color: var(--claude-bg);
            color: var(--claude-text);
        }

        .card {
            background-color: var(--claude-surface);
            border: 1px solid var(--claude-border);
        }

        .btn-primary {
            background-color: var(--claude-accent);
        }

        .btn-primary:hover {
            background-color: var(--claude-accent-hover);
        }

        /* 프롬프트 펼치기/접기 */
        .prompt-collapsed {
            max-height: 3em;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .prompt-expanded {
            max-height: none;
            white-space: pre-wrap;
        }

        /* 모달 오버레이 */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        /* 모달 애니메이션 */
        .modal-content {
            animation: slideIn 0.2s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="min-h-screen p-8">
    <div class="max-w-7xl mx-auto">
        <!-- 헤더 -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">Prompt 목록</h1>
            <p class="text-gray-400">저장된 프롬프트를 확인하고 평가하세요</p>
        </div>

        <!-- 필터 영역 -->
        <div class="card rounded-lg p-6 mb-6">
            <form th:action="@{/prompts}" method="get" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <!-- 카테고리 필터 -->
                    <div>
                        <label class="block text-sm font-medium mb-2">카테고리</label>
                        <select name="category" class="w-full px-3 py-2 bg-[#1a1a1a] border border-[#404040] rounded-md text-white focus:outline-none focus:border-[#cc785c]">
                            <option value="">전체</option>
                            <option th:each="cat : ${categories}"
                                    th:value="${cat}"
                                    th:text="${cat.description}"
                                    th:selected="${filter.category == cat}">
                            </option>
                        </select>
                    </div>

                    <!-- 최소 점수 -->
                    <div>
                        <label class="block text-sm font-medium mb-2">최소 만족도</label>
                        <input type="number" name="minSatisfaction"
                               th:value="${filter.minSatisfaction}"
                               min="0" max="10"
                               placeholder="0-10"
                               class="w-full px-3 py-2 bg-[#1a1a1a] border border-[#404040] rounded-md text-white focus:outline-none focus:border-[#cc785c]">
                    </div>

                    <!-- 최대 점수 -->
                    <div>
                        <label class="block text-sm font-medium mb-2">최대 만족도</label>
                        <input type="number" name="maxSatisfaction"
                               th:value="${filter.maxSatisfaction}"
                               min="0" max="10"
                               placeholder="0-10"
                               class="w-full px-3 py-2 bg-[#1a1a1a] border border-[#404040] rounded-md text-white focus:outline-none focus:border-[#cc785c]">
                    </div>

                    <!-- 페이지 크기 -->
                    <div>
                        <label class="block text-sm font-medium mb-2">페이지 크기</label>
                        <select name="size" class="w-full px-3 py-2 bg-[#1a1a1a] border border-[#404040] rounded-md text-white focus:outline-none focus:border-[#cc785c]">
                            <option th:each="size : ${pageSizes}"
                                    th:value="${size}"
                                    th:text="${size} + '개'"
                                    th:selected="${filter.size == size}">
                            </option>
                        </select>
                    </div>
                </div>

                <div class="flex justify-end space-x-3">
                    <a th:href="@{/prompts}" class="px-4 py-2 bg-[#404040] text-white rounded-md hover:bg-[#4a4a4a] transition">
                        초기화
                    </a>
                    <button type="submit" class="btn-primary px-4 py-2 text-white rounded-md hover:bg-[#b86b4f] transition">
                        검색
                    </button>
                </div>
            </form>
        </div>

        <!-- 테이블 -->
        <div class="card rounded-lg overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-[#1a1a1a] border-b border-[#404040]">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">프롬프트</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">카테고리</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">AI 모델</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">만족도</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">생성일</th>
                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider">상세보기</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-[#404040]">
                        <tr th:if="${#lists.isEmpty(prompts)}" class="hover:bg-[#333333] transition">
                            <td colspan="7" class="px-6 py-8 text-center text-gray-400">
                                저장된 프롬프트가 없습니다.
                            </td>
                        </tr>
                        <tr th:each="prompt : ${prompts}" class="hover:bg-[#333333] transition">
                            <td class="px-6 py-4 whitespace-nowrap text-sm" th:text="${prompt.id}"></td>
                            <td class="px-6 py-4 text-sm">
                                <div class="max-w-md">
                                    <div th:id="'prompt-' + ${prompt.id}" class="prompt-collapsed" th:text="${prompt.content}"></div>
                                    <button th:if="${#strings.length(prompt.content) > 100}"
                                            th:onclick="'togglePrompt(' + ${prompt.id} + ')'"
                                            class="mt-1 text-xs text-[#cc785c] hover:text-[#b86b4f] flex items-center">
                                        <span th:id="'toggle-icon-' + ${prompt.id}">▼ 더보기</span>
                                    </button>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                <span th:if="${prompt.category}"
                                      class="px-2 py-1 text-xs rounded-full bg-[#cc785c] bg-opacity-20 text-[#cc785c]"
                                      th:text="${prompt.categoryDescription}">
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400" th:text="${prompt.aiModel}"></td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                <span th:if="${prompt.overallSatisfaction != null}"
                                      class="font-semibold"
                                      th:classappend="${prompt.overallSatisfaction >= 7} ? 'text-green-400' : (${prompt.overallSatisfaction >= 4} ? 'text-yellow-400' : 'text-red-400')"
                                      th:text="${prompt.overallSatisfaction} + '/10'">
                                </span>
                                <span th:if="${prompt.overallSatisfaction == null}" class="text-gray-500">-</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400"
                                th:text="${#temporals.format(prompt.createdAt, 'yyyy-MM-dd HH:mm')}">
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                                <button onclick="openModal(this)"
                                        th:attr="data-id=${prompt.id},
                                                 data-content=${prompt.content},
                                                 data-category=${prompt.categoryDescription},
                                                 data-ai-model=${prompt.aiModel},
                                                 data-created-at=${#temporals.format(prompt.createdAt, 'yyyy-MM-dd HH:mm')},
                                                 data-response-text=${prompt.responseText},
                                                 data-goal-achievement=${prompt.goalAchievement},
                                                 data-execution-success=${prompt.executionSuccess},
                                                 data-response-quality=${prompt.responseQuality},
                                                 data-efficiency=${prompt.efficiency},
                                                 data-reusability=${prompt.reusability},
                                                 data-overall-satisfaction=${prompt.overallSatisfaction},
                                                 data-comment=${prompt.comment}"
                                        class="text-[#cc785c] hover:text-[#b86b4f] transition"
                                        title="상세보기">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 페이지네이션 -->
        <div th:if="${page.totalPages > 1}" class="mt-6 flex items-center justify-between">
            <div class="text-sm text-gray-400">
                총 <span th:text="${page.totalElements}"></span>개 중
                <span th:text="${page.number * page.size + 1}"></span>-<span th:text="${#numbers.min(page.number * page.size + page.size, page.totalElements)}"></span>
            </div>

            <div class="flex space-x-2">
                <!-- 이전 페이지 -->
                <a th:if="${!page.first}"
                   th:href="@{/prompts(page=${page.number - 1}, size=${filter.size}, category=${filter.category}, minSatisfaction=${filter.minSatisfaction}, maxSatisfaction=${filter.maxSatisfaction})}"
                   class="px-3 py-2 bg-[#404040] text-white rounded-md hover:bg-[#4a4a4a] transition">
                    이전
                </a>
                <span th:if="${page.first}" class="px-3 py-2 bg-[#2d2d2d] text-gray-600 rounded-md cursor-not-allowed">
                    이전
                </span>

                <!-- 페이지 번호 -->
                <div class="flex space-x-1">
                    <th:block th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}">
                        <a th:if="${i >= page.number - 2 && i <= page.number + 2}"
                           th:href="@{/prompts(page=${i}, size=${filter.size}, category=${filter.category}, minSatisfaction=${filter.minSatisfaction}, maxSatisfaction=${filter.maxSatisfaction})}"
                           th:classappend="${i == page.number} ? 'bg-[#cc785c] text-white' : 'bg-[#404040] text-white hover:bg-[#4a4a4a]'"
                           class="px-3 py-2 rounded-md transition"
                           th:text="${i + 1}">
                        </a>
                    </th:block>
                </div>

                <!-- 다음 페이지 -->
                <a th:if="${!page.last}"
                   th:href="@{/prompts(page=${page.number + 1}, size=${filter.size}, category=${filter.category}, minSatisfaction=${filter.minSatisfaction}, maxSatisfaction=${filter.maxSatisfaction})}"
                   class="px-3 py-2 bg-[#404040] text-white rounded-md hover:bg-[#4a4a4a] transition">
                    다음
                </a>
                <span th:if="${page.last}" class="px-3 py-2 bg-[#2d2d2d] text-gray-600 rounded-md cursor-not-allowed">
                    다음
                </span>
            </div>
        </div>
    </div>

    <!-- 상세보기 모달 -->
    <div id="detailModal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-overlay" onclick="closeModal(event)">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="modal-content card rounded-lg max-w-4xl w-full p-8" onclick="event.stopPropagation()">
                <!-- 모달 헤더 -->
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">프롬프트 상세 정보</h2>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl">×</button>
                </div>

                <!-- 모달 내용 -->
                <div class="space-y-6">
                    <!-- 기본 정보 -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <span class="text-sm text-gray-400">ID</span>
                            <p id="modal-id" class="text-lg font-semibold"></p>
                        </div>
                        <div>
                            <span class="text-sm text-gray-400">카테고리</span>
                            <p id="modal-category" class="text-lg"></p>
                        </div>
                        <div>
                            <span class="text-sm text-gray-400">AI 모델</span>
                            <p id="modal-aiModel" class="text-lg"></p>
                        </div>
                        <div>
                            <span class="text-sm text-gray-400">생성일</span>
                            <p id="modal-createdAt" class="text-lg"></p>
                        </div>
                    </div>

                    <!-- 프롬프트 내용 -->
                    <div>
                        <span class="text-sm text-gray-400">프롬프트 내용</span>
                        <div id="modal-content" class="mt-2 p-4 bg-[#1a1a1a] rounded-lg whitespace-pre-wrap"></div>
                    </div>

                    <!-- AI 응답 -->
                    <div id="modal-response-section" class="hidden">
                        <span class="text-sm text-gray-400">AI 응답</span>
                        <div id="modal-responseText" class="mt-2 p-4 bg-[#1a1a1a] rounded-lg whitespace-pre-wrap"></div>
                    </div>

                    <!-- 평가 점수 -->
                    <div id="modal-scores-section" class="hidden">
                        <span class="text-sm text-gray-400 block mb-3">평가 점수</span>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <div class="bg-[#1a1a1a] p-4 rounded-lg">
                                <p class="text-xs text-gray-400 mb-1">목표 달성도</p>
                                <p id="modal-goalAchievement" class="text-2xl font-bold text-[#cc785c]">-</p>
                            </div>
                            <div class="bg-[#1a1a1a] p-4 rounded-lg">
                                <p class="text-xs text-gray-400 mb-1">응답 품질</p>
                                <p id="modal-responseQuality" class="text-2xl font-bold text-[#cc785c]">-</p>
                            </div>
                            <div class="bg-[#1a1a1a] p-4 rounded-lg">
                                <p class="text-xs text-gray-400 mb-1">효율성</p>
                                <p id="modal-efficiency" class="text-2xl font-bold text-[#cc785c]">-</p>
                            </div>
                            <div class="bg-[#1a1a1a] p-4 rounded-lg">
                                <p class="text-xs text-gray-400 mb-1">재사용 가능성</p>
                                <p id="modal-reusability" class="text-2xl font-bold text-[#cc785c]">-</p>
                            </div>
                            <div class="bg-[#1a1a1a] p-4 rounded-lg">
                                <p class="text-xs text-gray-400 mb-1">실행 성공 여부</p>
                                <p id="modal-executionSuccess" class="text-2xl font-bold">-</p>
                            </div>
                            <div class="bg-[#1a1a1a] p-4 rounded-lg">
                                <p class="text-xs text-gray-400 mb-1">종합 만족도</p>
                                <p id="modal-overallSatisfaction" class="text-2xl font-bold text-green-400">-</p>
                            </div>
                        </div>
                    </div>

                    <!-- 코멘트 -->
                    <div id="modal-comment-section" class="hidden">
                        <span class="text-sm text-gray-400">코멘트</span>
                        <div id="modal-comment" class="mt-2 p-4 bg-[#1a1a1a] rounded-lg whitespace-pre-wrap"></div>
                    </div>
                </div>

                <!-- 모달 푸터 -->
                <div class="mt-8 flex justify-end">
                    <button onclick="closeModal()" class="px-6 py-2 bg-[#404040] text-white rounded-md hover:bg-[#4a4a4a] transition">
                        닫기
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 프롬프트 펼치기/접기
        function togglePrompt(id) {
            const promptEl = document.getElementById('prompt-' + id);
            const iconEl = document.getElementById('toggle-icon-' + id);

            if (promptEl.classList.contains('prompt-collapsed')) {
                promptEl.classList.remove('prompt-collapsed');
                promptEl.classList.add('prompt-expanded');
                iconEl.textContent = '▲ 접기';
            } else {
                promptEl.classList.add('prompt-collapsed');
                promptEl.classList.remove('prompt-expanded');
                iconEl.textContent = '▼ 더보기';
            }
        }

        // 모달 열기
        function openModal(button) {
            const dataset = button.dataset;

            // 기본 정보
            document.getElementById('modal-id').textContent = dataset.id || '-';
            document.getElementById('modal-category').textContent = dataset.category || '-';
            document.getElementById('modal-aiModel').textContent = dataset.aiModel || '-';
            document.getElementById('modal-createdAt').textContent = dataset.createdAt || '-';
            document.getElementById('modal-content').textContent = dataset.content || '';

            // AI 응답
            if (dataset.responseText && dataset.responseText !== 'null') {
                document.getElementById('modal-response-section').classList.remove('hidden');
                document.getElementById('modal-responseText').textContent = dataset.responseText;
            } else {
                document.getElementById('modal-response-section').classList.add('hidden');
            }

            // 평가 점수
            const hasScores = dataset.goalAchievement !== 'null' || dataset.responseQuality !== 'null';
            if (hasScores) {
                document.getElementById('modal-scores-section').classList.remove('hidden');
                document.getElementById('modal-goalAchievement').textContent =
                    dataset.goalAchievement !== 'null' ? dataset.goalAchievement + '/10' : '-';
                document.getElementById('modal-responseQuality').textContent =
                    dataset.responseQuality !== 'null' ? dataset.responseQuality + '/10' : '-';
                document.getElementById('modal-efficiency').textContent =
                    dataset.efficiency !== 'null' ? dataset.efficiency + '/10' : '-';
                document.getElementById('modal-reusability').textContent =
                    dataset.reusability !== 'null' ? dataset.reusability + '/10' : '-';
                document.getElementById('modal-executionSuccess').textContent =
                    dataset.executionSuccess !== 'null' ? (dataset.executionSuccess === 'true' ? '✓ 성공' : '✗ 실패') : '-';
                document.getElementById('modal-overallSatisfaction').textContent =
                    dataset.overallSatisfaction !== 'null' ? dataset.overallSatisfaction + '/10' : '-';
            } else {
                document.getElementById('modal-scores-section').classList.add('hidden');
            }

            // 코멘트
            if (dataset.comment && dataset.comment !== 'null') {
                document.getElementById('modal-comment-section').classList.remove('hidden');
                document.getElementById('modal-comment').textContent = dataset.comment;
            } else {
                document.getElementById('modal-comment-section').classList.add('hidden');
            }

            // 모달 표시
            document.getElementById('detailModal').classList.remove('hidden');
        }

        // 모달 닫기
        function closeModal(event) {
            if (!event || event.target === event.currentTarget) {
                document.getElementById('detailModal').classList.add('hidden');
            }
        }

        // ESC 키로 모달 닫기
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
